{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Message Input Schema",
  "description": "Схема входящих сообщений для анализа AI медиатора",
  "type": "object",
  "required": [
    "pair_id",
    "messages"
  ],
  "properties": {
    "pair_id": {
      "type": "string",
      "description": "Идентификатор пары",
      "pattern": "^pair_[a-zA-Z0-9]+$"
    },
    "messages": {
      "type": "array",
      "description": "Массив сообщений для анализа",
      "minItems": 2,
      "maxItems": 50,
      "items": {
        "type": "object",
        "required": [
          "message_id",
          "user_id", 
          "content",
          "timestamp"
        ],
        "properties": {
          "message_id": {
            "type": "string",
            "description": "Уникальный идентификатор сообщения"
          },
          "user_id": {
            "type": "string",
            "description": "Идентификатор отправителя",
            "pattern": "^user_[a-zA-Z0-9]+$"
          },
          "content": {
            "type": "string",
            "description": "Текст сообщения",
            "minLength": 1,
            "maxLength": 4000
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Время отправки сообщения"
          },
          "message_type": {
            "type": "string",
            "enum": ["text", "voice_transcription", "forwarded"],
            "default": "text",
            "description": "Тип сообщения"
          },
          "is_edited": {
            "type": "boolean",
            "default": false,
            "description": "Было ли сообщение отредактировано"
          },
          "reply_to_message_id": {
            "type": "string",
            "description": "ID сообщения, на которое отвечает данное"
          }
        }
      }
    },
    "context": {
      "type": "object",
      "description": "Дополнительный контекст для анализа",
      "properties": {
        "relationship_duration": {
          "type": "string",
          "enum": ["less_than_year", "1-3_years", "3-5_years", "more_than_5_years"],
          "description": "Длительность отношений"
        },
        "previous_conflicts": {
          "type": "array",
          "description": "Темы предыдущих конфликтов",
          "items": {
            "type": "string"
          }
        },
        "communication_language": {
          "type": "string", 
          "default": "ru",
          "description": "Язык общения пары"
        },
        "time_zone": {
          "type": "string",
          "description": "Часовой пояс пары для анализа времени сообщений"
        }
      }
    },
    "trigger_reason": {
      "type": "string",
      "enum": [
        "message_threshold_reached",
        "conflict_escalation_detected", 
        "help_requested",
        "long_silence_detected",
        "manual_trigger"
      ],
      "description": "Причина запуска медиации"
    }
  }
}
